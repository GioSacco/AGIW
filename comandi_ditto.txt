# clone the repo
!git clone https://github.com/megagonlabs/ditto
%cd ditto/

# install requirements
!pip install -r requirements.txt

# if the above command does not work:
!pip install transformers
!pip install tensorboardX

%cd ..

import nltk
nltk.download('stopwords')

pip install torch==1.9.0+cu102 torchvision==0.10.0+cu102 -f https://download.pytorch.org/whl/torch_stable.html

!git clone https://github.com/NVIDIA/apex
%cd apex
!pip install -v --no-cache-dir ./
%cd ..

!pip install --upgrade "urllib3==1.25.4" awscli

 %cd ditto

 !CUDA_VISIBLE_DEVICES=0 python train_ditto.py \
  --task AirBB \ 
  --batch_size 32 \
  --max_len 128 \
  --lr 3e-5 \
  --n_epochs 1 \
  --finetuning \
  --lm roberta \
  --fp16 \
  --da drop_col

 !CUDA_VISIBLE_DEVICES=0 python matcher.py \
  --task AirBB \
  --input_path data/er_magellan/AirBB/test.txt \
  --output_path output/output_small.jsonl \
  --lm roberta \
  --max_len 64 \
  --use_gpu \
  --fp16 \
  --checkpoint_path checkpoints/
